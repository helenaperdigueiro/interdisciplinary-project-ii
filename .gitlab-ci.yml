stages:
  - build
  - deploy

checkout_test_branch:
  stage: build
  script:
    - git checkout teste

build:
  stage: build
  script:
    - ssh -i $SSH_KEY $EC2_INSTANCE_TESTE
    - cd grupo1
    - cd account-service
    - echo "Build started..."
    - mvn install -DskipTests
    - docker build -t account-service-image .
    - echo "Build finished"
  rules:
    - if: '$CI_COMMIT_BRANCH == "teste"'

deploy:
  stage: deploy
  script:
    - echo "Deploy started..."
    - docker-compose up -d
    - echo "Deploy finished"
  rules:
    - if: '$CI_COMMIT_BRANCH == "teste"'
